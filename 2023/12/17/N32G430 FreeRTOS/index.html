

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Banned104">
  <meta name="keywords" content="">
  
    <meta name="description" content="N32G430 FreeRTOSN32及其外设研究N32从时钟源到TIMx定时器时钟源 如何从RC 8MHz 得到 系统时钟SYSCLK的128MHz：[基于Bootloader工程]   上面代码片段来自 bootloader 工程中的 system_n32g430.c； 其中&#96;SYSCLK_SRC&#96;​ 即时钟树中SYSCLK-128MHzMAX选择系统时钟源的宏定义；使用的是&#96;SYSCLK_U">
<meta property="og:type" content="article">
<meta property="og:title" content="N32G430 FreeRTOS移植研究">
<meta property="og:url" content="http://example.com/2023/12/17/N32G430%20FreeRTOS/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="N32G430 FreeRTOSN32及其外设研究N32从时钟源到TIMx定时器时钟源 如何从RC 8MHz 得到 系统时钟SYSCLK的128MHz：[基于Bootloader工程]   上面代码片段来自 bootloader 工程中的 system_n32g430.c； 其中&#96;SYSCLK_SRC&#96;​ 即时钟树中SYSCLK-128MHzMAX选择系统时钟源的宏定义；使用的是&#96;SYSCLK_U">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042359.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042361.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042362.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042363.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042364.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042365.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042366.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042367.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042368.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042369.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042370.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042371.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042372.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042373.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042374.png">
<meta property="og:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170123651.png">
<meta property="article:published_time" content="2023-12-16T16:44:49.324Z">
<meta property="article:modified_time" content="2023-12-16T17:23:44.934Z">
<meta property="article:author" content="Banned104">
<meta property="article:tag" content="嵌入式">
<meta property="article:tag" content="ARM">
<meta property="article:tag" content="FreeRTOS">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042359.png">
  
  
  
  <title>N32G430 FreeRTOS移植研究 - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.6","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":"6ae032dfc86e4765e12f04dae7715eee","google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  
    <!-- Baidu Analytics -->
    <script async>
      if (!Fluid.ctx.dnt) {
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?6ae032dfc86e4765e12f04dae7715eee";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
      }
    </script>
  

  
    <!-- Google tag (gtag.js) -->
    <script async>
      if (!Fluid.ctx.dnt) {
        Fluid.utils.createScript("https://www.googletagmanager.com/gtag/js?id=", function() {
          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          gtag('js', new Date());
          gtag('config', '');
        });
      }
    </script>
  

  

  

  

  



  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="N32G430 FreeRTOS移植研究"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-12-17 00:44" pubdate>
          December 17, 2023 am
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          625 words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          6 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">N32G430 FreeRTOS移植研究</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="N32G430-FreeRTOS"><a href="#N32G430-FreeRTOS" class="headerlink" title="N32G430 FreeRTOS"></a>N32G430 FreeRTOS</h1><h2 id="N32及其外设研究"><a href="#N32及其外设研究" class="headerlink" title="N32及其外设研究"></a>N32及其外设研究</h2><h3 id="N32从时钟源到TIMx定时器"><a href="#N32从时钟源到TIMx定时器" class="headerlink" title="N32从时钟源到TIMx定时器"></a>N32从时钟源到TIMx定时器</h3><h4 id="时钟源-如何从RC-8MHz-得到-系统时钟SYSCLK的128MHz："><a href="#时钟源-如何从RC-8MHz-得到-系统时钟SYSCLK的128MHz：" class="headerlink" title="时钟源 如何从RC 8MHz 得到 系统时钟SYSCLK的128MHz："></a>时钟源 如何从RC 8MHz 得到 系统时钟SYSCLK的128MHz：</h4><p>[基于Bootloader工程]</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042359.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042361.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>上面代码片段来自 bootloader 工程中的 system_n32g430.c；</p>
<pre><code class="hljs">其中`SYSCLK_SRC`​ 即时钟树中SYSCLK-128MHzMAX选择系统时钟源的宏定义；使用的是`SYSCLK_USE_HSI_PLL`​也就是经过PLL倍频的内部RC时钟，而非直接使用8MHz的RC时钟；	三个时钟来源 HSI; HSE; PLLCLK; 一般都是使用PLLCLK；

因为配置了`SYSCLK_USE_HSI_PLL`​ 且 #define SYSCLK_FREQ 128000000 【直接定义系统时钟为最大值128MHz】，所以计算其倍频系数：
</code></pre>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">define</span> SYSCLK_FREQ 128000000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> HSI_VALUE (8000000) <span class="hljs-comment">/* Value of the Internal oscillator in Hz */</span></span><br><span class="hljs-comment">//-----------------------------------------</span><br><span class="hljs-meta">#<span class="hljs-keyword">elif</span> SYSCLK_SRC == SYSCLK_USE_HSI_PLL</span><br><br>    <span class="hljs-meta">#<span class="hljs-keyword">if</span> (SYSCLK_FREQ % (HSI_VALUE / 2) == 0) &amp;&amp; (SYSCLK_FREQ / (HSI_VALUE / 2) &gt;= 2)                                       \</span><br><span class="hljs-meta">        &amp;&amp; (SYSCLK_FREQ / (HSI_VALUE / 2) &lt;= 32)</span><br><br>        <span class="hljs-meta">#<span class="hljs-keyword">define</span> PLLSRC_DIV 2							     <span class="hljs-comment">// PLL倍频前对RC时钟分频 /2 = 4MHz</span></span><br>        <span class="hljs-meta">#<span class="hljs-keyword">define</span> PLL_MUL    (SYSCLK_FREQ / (HSI_VALUE / 2))	 <span class="hljs-comment">// PLL倍频 32倍；对应时钟树中的 PLLMULFCT</span></span><br>		<span class="hljs-comment">// 最后得到4*32 = 128MHz</span><br></code></pre></td></tr></table></figure>

<h4 id="TIM6定时器配置"><a href="#TIM6定时器配置" class="headerlink" title="TIM6定时器配置"></a>TIM6定时器配置</h4><p>[<del>基于官方配置TIM的工程</del>，和Bootloader工程类似 都是  8&#x2F;2 -&gt; *32 &#x3D; SYSCLK_128MHz]</p>
<p>代码片段来自 bootloader 工程中的 system_n32g430.c；此处配置了从SYSCLK_128MHz到TIM6所在的APB1总线的分频系数；</p>
<p>系统时钟为128MHz &gt; 64M 所以配置4分频；所以TIM6定时器的时钟是32MHz</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">/* PCLK1 max 32M */</span><br><span class="hljs-keyword">if</span> (SYSCLK_FREQ &gt; SYSCLK_FREQ_64M)<br>&#123;<br>    RCC-&gt;CFG |= (<span class="hljs-type">uint32_t</span>)RCC_CFG_APB1PRES_DIV4;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (SYSCLK_FREQ &gt; SYSCLK_FREQ_32M)<br>&#123;<br>    RCC-&gt;CFG |= (<span class="hljs-type">uint32_t</span>)RCC_CFG_APB1PRES_DIV2;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    RCC-&gt;CFG |= (<span class="hljs-type">uint32_t</span>)RCC_CFG_APB1PRES_DIV1;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042362.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042363.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<pre><code class="hljs">上面两张图很重要的两点就是， HCLK == SYSCLK == 128MHz；而且从HCLK到TIM6的时钟只经过了一次分频，也就是从128MHz经过4分频得到32MHz；因为分频系数不为1，所以又倍频了一次 x2 ；所以TIM6的时钟是64MHz；	

所以配置TIM6 1ms中断的代码是这样的：配置分频系数为64-1，变为1x10^6^Hz；再配置计数值为1000；所以 10^6^/1000 = 1000; 1s有1000次触发也就是1ms触发一次中断；

这里应该是1000-1；

TIM_Base_Reload_Mode_Set(TIM6, TIM_PSC_RELOAD_MODE_IMMEDIATE); 表示溢出立即重装载；
</code></pre>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> <span class="hljs-title function_">hw_tim6_init</span><span class="hljs-params">(hw_timer_iqr_callback cb)</span><br>&#123;<br>    <span class="hljs-comment">//----------------------------------------------------------------</span><br>    pTickCallback = cb;<br><br>    <span class="hljs-comment">//----------------------------------------------------------------</span><br><br>    <span class="hljs-comment">//----------------------------------------------------------------</span><br>    <span class="hljs-comment">// TIM6 每1ms中断一次。使能中断，作为系统滴答。</span><br><br>    RCC_APB1_Peripheral_Clock_Enable(RCC_APB1_PERIPH_TIM6);<br><br>    NVIC_InitType NVIC_InitStructure;<br>    NVIC_InitStructure.NVIC_IRQChannel = TIM6_IRQn;<br>    NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = <span class="hljs-number">0</span>;<br>    NVIC_InitStructure.NVIC_IRQChannelSubPriority = <span class="hljs-number">1</span>;<br>    NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;<br>    NVIC_Initializes(&amp;NVIC_InitStructure);<br><br>    TIM_TimeBaseInitType TIM_TimeBaseStructure;<br>    TIM_Base_Struct_Initialize(&amp;TIM_TimeBaseStructure);<br>    TIM_TimeBaseStructure.Period = <span class="hljs-number">1000</span>;<br>    TIM_TimeBaseStructure.Prescaler = <span class="hljs-number">64</span> - <span class="hljs-number">1</span>;<br>    TIM_TimeBaseStructure.ClkDiv = <span class="hljs-number">0</span>;<br>    TIM_TimeBaseStructure.CntMode = TIM_CNT_MODE_UP;<br>    TIM_Base_Initialize(TIM6, &amp;TIM_TimeBaseStructure);<br><br>    TIM_Base_Reload_Mode_Set(TIM6, TIM_PSC_RELOAD_MODE_IMMEDIATE);<br><br>    TIM_Interrupt_Enable(TIM6, TIM_INT_UPDATE);<br><br>    TIM_On(TIM6);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>‍</p>
<p>‍</p>
<h3 id="串口与GPIO【FreeRTOS移植】"><a href="#串口与GPIO【FreeRTOS移植】" class="headerlink" title="串口与GPIO【FreeRTOS移植】"></a>串口与GPIO【FreeRTOS移植】</h3><h4 id="使用之前配置好的FreeRTOS工程（TODO-但是没有跑FreeRTOS-还得改-可能Systick这部分再看看）"><a href="#使用之前配置好的FreeRTOS工程（TODO-但是没有跑FreeRTOS-还得改-可能Systick这部分再看看）" class="headerlink" title="使用之前配置好的FreeRTOS工程（TODO:但是没有跑FreeRTOS 还得改 可能Systick这部分再看看）"></a>使用之前配置好的FreeRTOS工程（TODO:但是没有跑FreeRTOS 还得改 可能Systick这部分再看看）</h4><p>E:\1SuperUAV\N32Projs\FreeRTOS\MDK-ARM</p>
<h4 id="N32工程配置：Flash大小"><a href="#N32工程配置：Flash大小" class="headerlink" title="N32工程配置：Flash大小"></a>N32工程配置：Flash大小</h4><p>首先 N32G430 用的参数是 N32G430C8Q7 64KBFlash 16KRAM</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042364.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>之前配置的SUAV的 Bootloader 工程是 0x4000; 4*2 8k的空间；</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042365.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>FreeRTOS工程使用的空间为64K 0x10000 2^16^ &#x3D; 2^6^ *1024 &#x3D; 64KB</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042366.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>‍</p>
<p>‍</p>
<h4 id="N32配置串口及其DMA和空闲中断："><a href="#N32配置串口及其DMA和空闲中断：" class="headerlink" title="N32配置串口及其DMA和空闲中断："></a>N32配置串口及其DMA和空闲中断：</h4><h5 id="出现的问题：两个版本的用户手册配置不一样，配置GPIO-Alternative-G430手册和G43x手册居然不一样。"><a href="#出现的问题：两个版本的用户手册配置不一样，配置GPIO-Alternative-G430手册和G43x手册居然不一样。" class="headerlink" title="出现的问题：两个版本的用户手册配置不一样，配置GPIO.Alternative G430手册和G43x手册居然不一样。"></a>出现的问题：两个版本的用户手册配置不一样，配置GPIO.Alternative G430手册和G43x手册居然不一样。</h5><p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042367.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<p>‍</p>
<h5 id="【1215】出现的问题：FreeRTOS没有配置Systick，或者说没有配置对，导致delay时间完全对不上；"><a href="#【1215】出现的问题：FreeRTOS没有配置Systick，或者说没有配置对，导致delay时间完全对不上；" class="headerlink" title="【1215】出现的问题：FreeRTOS没有配置Systick，或者说没有配置对，导致delay时间完全对不上；"></a>【1215】出现的问题：FreeRTOS没有配置Systick，或者说没有配置对，导致delay时间完全对不上；</h5><h6 id="对于内核文件中初始化Systick的函数的思考"><a href="#对于内核文件中初始化Systick的函数的思考" class="headerlink" title="对于内核文件中初始化Systick的函数的思考"></a>对于内核文件中初始化Systick的函数的思考</h6><p>重新看了移植手册，最后还有一段配置Systick的，在思考main执行之前有没有配置Systick：</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042368.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>再看时钟树，Systick的频率为 HCLK&#x2F;8</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042369.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>‍</p>
<p>在文件core_cm4.h中找到Systick_Config函数：</p>
<p>&#x3D;&#x3D;	&#x3D;&#x3D;​**<u>&#x3D;&#x3D;大致就是配置了溢出值，也就是SysTick-&gt;LOAD的值；关键就是使用这个寄存器配置 Systick中断的间隔；&#x3D;&#x3D;</u>**</p>
<pre><code class="hljs">#if defined (__Vendor_SysTickConfig) &amp;&amp; (__Vendor_SysTickConfig == 0U) 这一句就是 检查有没有定义 __Vendor_SysTickConfig 这个宏，还有这个宏是否为0，__Vendor_SysTickConfig，
</code></pre>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs C"><br><span class="hljs-comment">/* ##################################    SysTick function  ############################################ */</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  \ingroup  CMSIS_Core_FunctionInterface</span><br><span class="hljs-comment">  \defgroup CMSIS_Core_SysTickFunctions SysTick Functions</span><br><span class="hljs-comment">  \brief    Functions that configure the System.</span><br><span class="hljs-comment">  @&#123;</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> defined (__Vendor_SysTickConfig) &amp;&amp; (__Vendor_SysTickConfig == 0U)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  \brief   System Tick Configuration</span><br><span class="hljs-comment">  \details Initializes the System Timer and its interrupt, and starts the System Tick Timer.</span><br><span class="hljs-comment">           Counter is in free running mode to generate periodic interrupts.</span><br><span class="hljs-comment">  \param [in]  ticks  Number of ticks between two interrupts.</span><br><span class="hljs-comment">  \return          0  Function succeeded.</span><br><span class="hljs-comment">  \return          1  Function failed.</span><br><span class="hljs-comment">  \note    When the variable &lt;b&gt;__Vendor_SysTickConfig&lt;/b&gt; is set to 1, then the</span><br><span class="hljs-comment">           function &lt;b&gt;SysTick_Config&lt;/b&gt; is not included. In this case, the file &lt;b&gt;&lt;i&gt;device&lt;/i&gt;.h&lt;/b&gt;</span><br><span class="hljs-comment">           must contain a vendor-specific implementation of this function.</span><br><span class="hljs-comment"> */</span><br>__STATIC_INLINE <span class="hljs-type">uint32_t</span> <span class="hljs-title function_">SysTick_Config</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> ticks)</span><br>&#123;<br>  <span class="hljs-keyword">if</span> ((ticks - <span class="hljs-number">1UL</span>) &gt; SysTick_LOAD_RELOAD_Msk)<br>  &#123;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-number">1UL</span>);                                                   <span class="hljs-comment">/* Reload value impossible */</span><br>  &#125;<br><br>  SysTick-&gt;LOAD  = (<span class="hljs-type">uint32_t</span>)(ticks - <span class="hljs-number">1UL</span>);                         <span class="hljs-comment">/* set reload register */</span><br>  NVIC_SetPriority (SysTick_IRQn, (<span class="hljs-number">1UL</span> &lt;&lt; __NVIC_PRIO_BITS) - <span class="hljs-number">1UL</span>); <span class="hljs-comment">/* set Priority for Systick Interrupt */</span><br>  SysTick-&gt;VAL   = <span class="hljs-number">0UL</span>;                                             <span class="hljs-comment">/* Load the SysTick Counter Value */</span><br>  SysTick-&gt;CTRL  = SysTick_CTRL_CLKSOURCE_Msk |<br>                   SysTick_CTRL_TICKINT_Msk   |<br>                   SysTick_CTRL_ENABLE_Msk;                         <span class="hljs-comment">/* Enable SysTick IRQ and SysTick Timer */</span><br>  <span class="hljs-keyword">return</span> (<span class="hljs-number">0UL</span>);                                                     <span class="hljs-comment">/* Function successful */</span><br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-comment">/*@&#125; end of CMSIS_Core_SysTickFunctions */</span><br></code></pre></td></tr></table></figure>

<p>‍</p>
<h6 id="出现的问题：在系统时钟配置中错误选择了HSE导致HCLK只有8MHz，导致vTaskDelay时间错误："><a href="#出现的问题：在系统时钟配置中错误选择了HSE导致HCLK只有8MHz，导致vTaskDelay时间错误：" class="headerlink" title="出现的问题：在系统时钟配置中错误选择了HSE导致HCLK只有8MHz，导致vTaskDelay时间错误："></a>出现的问题：在系统时钟配置中错误选择了HSE导致HCLK只有8MHz，导致vTaskDelay时间错误：</h6><p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042370.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>我是真的服了，幸好过了一遍N32时钟部分</p>
<p>system_n32g430.c</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042371.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>‍</p>
<h6 id="对于Systick初始化函数的思考"><a href="#对于Systick初始化函数的思考" class="headerlink" title="对于Systick初始化函数的思考"></a>对于Systick初始化函数的思考</h6><p>时钟树里面 HCLK&#x2F;8 是可选的，配置Systick时钟为128Mhz，用第一个函数；</p>
<p>第二个函数直接获取系统时钟然后配置LOAD寄存器；</p>
<p>SysTick-&gt;LOAD  &#x3D; reload;                                    &#x2F;&#x2F; 计数128 * 10^3 触发一次中断; 128K&#x2F;128M &#x3D; 1&#x2F;1000; 也就是1ms中断一次</p>
<p>CPU频率为128MHz，1s有128MHz个机器周期，设置溢出值为 128K，则 128M&#x2F;128K &#x3D; 1000；Systick在1s内有1000次中断，再配置为FreeRTOS的时间片即可；</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> <span class="hljs-title function_">mySystickInit</span><span class="hljs-params">( <span class="hljs-type">void</span> )</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> reload = <span class="hljs-number">0</span>;<br><br>    SysTick_Clock_Source_Set( SYSTICK_CLKSOURCE_HCLK );         <span class="hljs-comment">// 设置Systick时钟源为HCLK也就是128MHz 不经过分频  </span><br>    reload = ( SystemClockFrequency / <span class="hljs-number">1000000</span> );                <span class="hljs-comment">// SystemClockFrequency=128MHz</span><br>    reload *= ( <span class="hljs-number">1000000</span> / configTICK_RATE_HZ );                 <span class="hljs-comment">// FreeRTOSConfig.h -&gt; configTICK_RATE_HZ = 1000;</span><br>  <br><br><br>    SysTick-&gt;CTRL |= SysTick_CTRL_TICKINT_Msk;                  <span class="hljs-comment">// 开启Systick中断</span><br>    SysTick-&gt;LOAD  = reload;                                    <span class="hljs-comment">// 计数128 * 10^3 触发一次中断; 128K/128M = 1/1000; 也就是1ms中断一次</span><br>    SysTick-&gt;CTRL |= SysTick_CTRL_ENABLE_Msk;                   <span class="hljs-comment">// 开启Systick</span><br>  <br><br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">mySysTickInit2</span><span class="hljs-params">( <span class="hljs-type">void</span> )</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> reload = <span class="hljs-number">0</span>;<br>    RCC_ClocksType my_RCC_Clocks;<br>    RCC_Clocks_Frequencies_Value_Get( &amp;my_RCC_Clocks );<br><br>    NVIC_SetPriority (SysTick_IRQn, (<span class="hljs-number">1</span>&lt;&lt;__NVIC_PRIO_BITS) - <span class="hljs-number">1</span>);  <span class="hljs-comment">/* set Priority for Cortex-M0 System Interrupts */</span><br>    reload = ( my_RCC_Clocks.SysclkFreq / configTICK_RATE_HZ );<br><br><br>    SysTick-&gt;CTRL  |= SysTick_CTRL_ENABLE_Msk;   <br>	SysTick-&gt;LOAD  = reload;               <span class="hljs-comment">/* Enable SysTick IRQ and SysTick Timer */</span><br>    SysTick-&gt;CTRL  |= SysTick_CTRL_TICKINT_Msk;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>main中调用这个初始化函数即可：</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042372.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<h6 id="移植FreeRTOS到N32中还需要自己写一下Systick-Handler，在其中判断系统是否运行，已经运行则跑FreeRTOS的Tick函数；"><a href="#移植FreeRTOS到N32中还需要自己写一下Systick-Handler，在其中判断系统是否运行，已经运行则跑FreeRTOS的Tick函数；" class="headerlink" title="移植FreeRTOS到N32中还需要自己写一下Systick_Handler，在其中判断系统是否运行，已经运行则跑FreeRTOS的Tick函数；"></a>移植FreeRTOS到N32中还需要自己写一下Systick_Handler，在其中判断系统是否运行，已经运行则跑FreeRTOS的Tick函数；</h6><p>FreeRTOS功能文件：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;main.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;FreeRTOS.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;task.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;FreeRTOS_Source.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;function.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> <span class="hljs-title function_">xPortSysTickHandler</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">SysTick_Handler</span><span class="hljs-params">( <span class="hljs-type">void</span> )</span><br>&#123;<br>    <span class="hljs-keyword">if</span>( xTaskGetSchedulerState() != taskSCHEDULER_NOT_STARTED )     <span class="hljs-comment">// 如果系统已经运行</span><br>    &#123;<br>        xPortSysTickHandler();<br>    &#125;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">TaskMain</span><span class="hljs-params">( <span class="hljs-type">void</span> )</span><br>&#123;<br>        <span class="hljs-type">uint32_t</span> reload = <span class="hljs-number">0</span>;<br>        RCC_ClocksType my_RCC_Clocks;<br>    <span class="hljs-keyword">for</span>(;;)<br>    &#123;<br><br><br>        vTaskDelay( pdMS_TO_TICKS( <span class="hljs-number">1000</span> ) );<br>        GPIO_Pin_Toggle( LED_PORT, LED_1_PIN );<br>        GPIO_Pin_Toggle( LED_PORT, LED_2_PIN );<br>        GPIO_Pin_Toggle( LED_PORT, LED_3_PIN );<br>        GPIO_Pin_Toggle( LED_PORT, LED_4_PIN );<br><br><br>        RCC_Clocks_Frequencies_Value_Get( &amp;my_RCC_Clocks );<br>        reload = my_RCC_Clocks.SysclkFreq;<br>        <span class="hljs-built_in">printf</span>( <span class="hljs-string">&quot;clk:%d\n&quot;</span>, reload );<br>      <br><br>    &#125;<br><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">mySystickInit</span><span class="hljs-params">( <span class="hljs-type">void</span> )</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> reload = <span class="hljs-number">0</span>;<br><br>    SysTick_Clock_Source_Set( SYSTICK_CLKSOURCE_HCLK );         <span class="hljs-comment">// 设置Systick时钟源为HCLK也就是128MHz 不经过分频  </span><br>    reload = ( SystemClockFrequency / <span class="hljs-number">1000000</span> );                <span class="hljs-comment">// SystemClockFrequency=128MHz</span><br>    reload *= ( <span class="hljs-number">1000000</span> / configTICK_RATE_HZ );                 <span class="hljs-comment">// FreeRTOSConfig.h -&gt; configTICK_RATE_HZ = 1000;</span><br>  <br><br><br>    SysTick-&gt;CTRL |= SysTick_CTRL_TICKINT_Msk;                  <span class="hljs-comment">// 开启Systick中断</span><br>    SysTick-&gt;LOAD  = reload;                                    <span class="hljs-comment">// 计数128 * 10^3 触发一次中断; 128K/128M = 1/1000; 也就是1ms中断一次</span><br>    SysTick-&gt;CTRL |= SysTick_CTRL_ENABLE_Msk;                   <span class="hljs-comment">// 开启Systick</span><br>  <br><br>&#125;<br><span class="hljs-type">void</span> <span class="hljs-title function_">mySysTickInit2</span><span class="hljs-params">( <span class="hljs-type">void</span> )</span><br>&#123;<br>    <span class="hljs-type">uint32_t</span> reload = <span class="hljs-number">0</span>;<br>    RCC_ClocksType my_RCC_Clocks;<br>    RCC_Clocks_Frequencies_Value_Get( &amp;my_RCC_Clocks );<br><br>    NVIC_SetPriority (SysTick_IRQn, (<span class="hljs-number">1</span>&lt;&lt;__NVIC_PRIO_BITS) - <span class="hljs-number">1</span>);  <span class="hljs-comment">/* set Priority for Cortex-M0 System Interrupts */</span><br>    reload = ( my_RCC_Clocks.SysclkFreq / configTICK_RATE_HZ );<br><br><br>    SysTick-&gt;CTRL  |= SysTick_CTRL_ENABLE_Msk;   <br>	SysTick-&gt;LOAD  = reload;               <span class="hljs-comment">/* Enable SysTick IRQ and SysTick Timer */</span><br>    SysTick-&gt;CTRL  |= SysTick_CTRL_TICKINT_Msk;<br>&#125;<br><br><br></code></pre></td></tr></table></figure>

<p>‍</p>
<p><code>xPortSysTickHandler();</code>​ 这个函数在Port.c中</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042373.png" srcset="/img/loading.gif" lazyload alt="image"></p>
<p>‍</p>
<p>‍</p>
<h6 id="而且还要在FreeRTOSConfig-h中取消注释掉一个-define-define-xPortSysTickHandler-SysTick-Handler​"><a href="#而且还要在FreeRTOSConfig-h中取消注释掉一个-define-define-xPortSysTickHandler-SysTick-Handler​" class="headerlink" title="而且还要在FreeRTOSConfig.h中取消注释掉一个#define:#define xPortSysTickHandler SysTick_Handler​"></a>而且还要在FreeRTOSConfig.h中取消注释掉一个#define:<code>#define xPortSysTickHandler SysTick_Handler</code>​</h6><p>原因即上条笔记所写的 需要自己写Systick_Handler判断操作系统是否正在运行，运行了才跑​<code>xPortSysTickHandler </code>​</p>
<p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170042374.png" srcset="/img/loading.gif" lazyload alt="image">​</p>
<h6 id="额外"><a href="#额外" class="headerlink" title="额外"></a>额外</h6><p><img src="https://picgo-public-1215.oss-cn-shenzhen.aliyuncs.com/202312170123651.png" srcset="/img/loading.gif" lazyload alt="image-20231217012241406"></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/N32/" class="category-chain-item">N32</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" class="print-no-link">#嵌入式</a>
      
        <a href="/tags/ARM/" class="print-no-link">#ARM</a>
      
        <a href="/tags/FreeRTOS/" class="print-no-link">#FreeRTOS</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>N32G430 FreeRTOS移植研究</div>
      <div>http://example.com/2023/12/17/N32G430 FreeRTOS/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Banned104</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>December 17, 2023</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/17/N32%E4%B8%B2%E5%8F%A3%E7%A9%BA%E9%97%B2%E4%B8%AD%E6%96%ADDMA%E6%8E%A5%E6%94%B6%E4%B8%8D%E5%AE%9A%E9%95%BF%E6%95%B0%E6%8D%AE/" title="N32串口空闲中断DMA接收不定长数据">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">N32串口空闲中断DMA接收不定长数据</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/16/%E3%80%90%E7%A7%8B%E6%8B%9B%E3%80%91%E9%97%AE%E9%A2%98%E5%A4%A7%E7%BA%B2/" title="【秋招】问题大纲">
                        <span class="hidden-mobile">【秋招】问题大纲</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
